# gulp-release

This project is unpublished from NPM and just keep for recipe.

## Release to Git, NPM, RubyGems

Modify yourself.

### LiveScript (see compiled [javascript]() )

```LiveScript
require! {
  fs
  gulp
  'gulp-livescript'
  'gulp-header'
  'gulp-uglify'
  'gulp-rename'
  'gulp-bump'
  'gulp-exec'
  'gulp-conventional-changelog'
}

function getJsonFile
  fs.readFileSync './package.json', 'utf-8' |> JSON.parse

function getHeaderStream
  const jsonFile = getJsonFile!
  const date = new Date

  gulp-header """
/*! tomchentw-boilerplate - v #{ jsonFile.version } - #{ date }
 * #{ jsonFile.homepage }
 * Copyright (c) #{ date.getFullYear! } [#{ jsonFile.author.name }](#{ jsonFile.author.url });
 * Licensed [#{ jsonFile.license.type }](#{ jsonFile.license.url })
 */
"""

gulp.task 'release:bump' ->
  return gulp.src <[ package.json bower.json ]>
    .pipe gulp-bump type: 'patch'
    .pipe gulp.dest '.'

gulp.task 'release:build' <[ release:bump ]> ->
  return gulp.src 'src/tomchentw-boilerplate.ls'
    .pipe gulp-livescript!
    .pipe getHeaderStream!
    .pipe gulp.dest '.'
    .pipe gulp.dest 'vendor/assets/javascripts/'
    .pipe gulp-uglify!
    .pipe getHeaderStream!
    .pipe gulp-rename extname: '.min.js'
    .pipe gulp.dest '.'

gulp.task 'release:commit' <[ release:build ]> ->
  const jsonFile = getJsonFile!
  const commitMsg = "chore(release): v#{ jsonFile.version }"

  return gulp.src <[ package.json CHANGELOG.md ]>
    .pipe gulp-conventional-changelog!
    .pipe gulp.dest '.'
    .pipe gulp-exec('git add -A')
    .pipe gulp-exec("git commit -m '#{ commitMsg }'")
    .pipe gulp-exec("git tag -a v#{ jsonFile.version } -m '#{ commitMsg }'")

gulp.task 'publish:git' <[ release:commit ]> ->
  return gulp.src 'package.json'
    .pipe gulp-exec('git push')
    .pipe gulp-exec('git push --tags')

gulp.task 'publish:rubygems' <[ release:commit ]> ->
  return gulp.src 'package.json'
    .pipe gulp-exec('rake build release')

gulp.task 'publish:npm' <[ release:commit ]> ->
  return gulp.src 'package.json'
    .pipe gulp-exec('npm publish')

gulp.task 'release' <[ publish:git publish:rubygems publish:npm ]>
```

### JavaScript

```javascript
// Generated by LiveScript 1.2.0
var fs, gulp, gulpLivescript, gulpHeader, gulpUglify, gulpRename, gulpBump, gulpExec, gulpConventionalChangelog;
fs = require('fs');
gulp = require('gulp');
gulpLivescript = require('gulp-livescript');
gulpHeader = require('gulp-header');
gulpUglify = require('gulp-uglify');
gulpRename = require('gulp-rename');
gulpBump = require('gulp-bump');
gulpExec = require('gulp-exec');
gulpConventionalChangelog = require('gulp-conventional-changelog');

function getJsonFile(){
  return JSON.parse(
  fs.readFileSync('./package.json', 'utf-8'));
}

function getHeaderStream(){
  var jsonFile, date;
  jsonFile = getJsonFile();
  date = new Date;
  return gulpHeader("/*! tomchentw-boilerplate - v " + jsonFile.version + " - " + date + "\n * " + jsonFile.homepage + "\n * Copyright (c) " + date.getFullYear() + " [" + jsonFile.author.name + "](" + jsonFile.author.url + ");\n * Licensed [" + jsonFile.license.type + "](" + jsonFile.license.url + ")\n */");
}

gulp.task('release:bump', function(){
  return gulp
    .src(['package.json', 'bower.json'])
    .pipe(gulpBump({
      type: 'patch'
    }))
    .pipe(gulp.dest('.'));
});
gulp.task('release:build', ['release:bump'], function(){
  return gulp
    .src('src/tomchentw-boilerplate.ls')
    .pipe(gulpLivescript())
    .pipe(getHeaderStream())
    .pipe(gulp.dest('.'))
    .pipe(gulp.dest('vendor/assets/javascripts/'))
    .pipe(gulpUglify())
    .pipe(getHeaderStream())
    .pipe(gulpRename({
      extname: '.min.js'
    }))
    .pipe(gulp.dest('.'));
});
gulp.task('release:commit', ['release:build'], function(){
  var jsonFile, commitMsg;
  jsonFile = getJsonFile();
  commitMsg = "chore(release): v" + jsonFile.version;
  return gulp
    .src(['package.json', 'CHANGELOG.md'])
    .pipe(gulpConventionalChangelog())
    .pipe(gulp.dest('.'))
    .pipe(gulpExec('git add -A'))
    .pipe(gulpExec("git commit -m '" + commitMsg + "'"))
    .pipe(gulpExec("git tag -a v" + jsonFile.version + " -m '" + commitMsg + "'"));
});
gulp.task('publish:git', ['release:commit'], function(){
  return gulp
    .src('package.json')
    .pipe(gulpExec('git push'))
    .pipe(gulpExec('git push --tags'));
});
gulp.task('publish:rubygems', ['release:commit'], function(){
  return gulp
    .src('package.json')
    .pipe(gulpExec('rake build release'));
});
gulp.task('publish:npm', ['release:commit'], function(){
  return gulp
    .src('package.json')
    .pipe(gulpExec('npm publish'));
});
gulp.task('release', ['publish:git', 'publish:rubygems', 'publish:npm']);
```